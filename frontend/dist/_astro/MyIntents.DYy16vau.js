import{_ as O,w as I,W as _,g as W,p as S,s as x,C as A,a as D}from"./_plugin-vue_export-helper.CTKArEa2.js";import{g as L,M as V}from"./contractConfig.cbomkfKb.js";/* empty css                       */import{c as f,a as e,t as r,F as q,h as F,g as M,d as P,r as v,e as G,f as w}from"./runtime-core.esm-bundler.CJzaKusY.js";const R=P({__name:"MyIntents",setup(K,{expose:s}){s();const c=L(),a=v([]),g=v(null),i=v("Load intents to see claimable entries."),t=v(!1),y=v(null),T=G(()=>a.value.length>0);function C(){return V}function p(n,o){return`${n.toString()}-${o.toString()}`}async function b(){if(!I)throw new _;const n=await I.getAddresses();if(n[0])return g.value=n[0],n[0];const o=await I.requestAddresses();if(!o[0])throw new Error("Wallet did not return an account.");return g.value=o[0],o[0]}async function H(){if(!c){i.value=C();return}t.value=!0;try{const n=await b(),o=W({address:c,abi:x,client:S}),d=await o.read.startBlock(),B=await S.getContractEvents({address:c,abi:x,eventName:"IntentQueued",args:{user:n},strict:!0,fromBlock:d}),m=await Promise.all(B.map(async l=>{const u=l.args.windowId,E=l.args.intentId,h=await o.read.getIntent([u,E]);return{windowId:u,intentId:E,amountIn:h.amountIn,minOut:h.minOut,claimed:h.claimed,claimTxHash:null}}));m.sort((l,u)=>l.windowId===u.windowId?l.intentId===u.intentId?0:l.intentId>u.intentId?-1:1:l.windowId>u.windowId?-1:1),a.value=m,i.value=m.length===0?"No intents found for this wallet.":"Intents loaded."}catch(n){n instanceof _||n instanceof A||n instanceof Error?i.value=n.message:i.value="Failed to load intents."}finally{t.value=!1}}async function N(n){if(!c){i.value=C();return}const o=p(n.windowId,n.intentId);y.value=o;try{if(!I)throw new _;const[d]=await I.requestAddresses();if(!d)throw new Error("Wallet did not return an account.");const m=await(await D(c)).write.claim([n.windowId,n.intentId],{account:d});a.value=a.value.map(l=>l.windowId===n.windowId&&l.intentId===n.intentId?{...l,claimTxHash:m,claimed:!0}:l),i.value="Claim submitted."}catch(d){d instanceof _||d instanceof A||d instanceof Error?i.value=d.message:i.value="Claim failed."}finally{y.value=null}}const k={address:c,intents:a,account:g,message:i,loading:t,claimBusyKey:y,hasIntents:T,addressError:C,toKey:p,ensureAccount:b,loadIntents:H,claimIntent:N};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}}),j={class:"panel"},Q={class:"actions"},z=["disabled"],J={class:"message"},U={key:0,class:"list"},X=["disabled","onClick"],Y={key:0,class:"tx"};function Z(K,s,c,a,g,i){return w(),f("div",j,[e("div",Q,[e("button",{class:"button",type:"button",disabled:a.loading,onClick:a.loadIntents},r(a.loading?"Loading...":"Load My Intents"),9,z)]),e("p",J,r(a.message),1),a.hasIntents?(w(),f("div",U,[(w(!0),f(q,null,F(a.intents,t=>(w(),f("article",{key:a.toKey(t.windowId,t.intentId),class:"item"},[e("dl",null,[e("div",null,[s[0]||(s[0]=e("dt",null,"Window",-1)),e("dd",null,r(t.windowId),1)]),e("div",null,[s[1]||(s[1]=e("dt",null,"Intent",-1)),e("dd",null,r(t.intentId),1)]),e("div",null,[s[2]||(s[2]=e("dt",null,"Amount In",-1)),e("dd",null,r(t.amountIn),1)]),e("div",null,[s[3]||(s[3]=e("dt",null,"Min Out",-1)),e("dd",null,r(t.minOut),1)]),e("div",null,[s[4]||(s[4]=e("dt",null,"Status",-1)),e("dd",null,r(t.claimed?"Claimed":"Claimable"),1)])]),e("button",{class:"button",type:"button",disabled:t.claimed||a.claimBusyKey===a.toKey(t.windowId,t.intentId),onClick:y=>a.claimIntent(t)},r(a.claimBusyKey===a.toKey(t.windowId,t.intentId)?"Claiming...":t.claimed?"Claimed":"Claim"),9,X),t.claimTxHash?(w(),f("p",Y,"Claim Tx: "+r(t.claimTxHash),1)):M("",!0)]))),128))])):M("",!0)])}const at=O(R,[["render",Z],["__scopeId","data-v-42ff2b80"]]);export{at as default};
