---
/*
Docs references:
- Astro islands (`client:load`): https://docs.astro.build/en/concepts/islands/
- Uniswap v4 hooks concept (pool-scoped hook execution): https://docs.uniswap.org/contracts/v4/concepts/hooks
- Uniswap v4 PoolManager lifecycle overview: https://docs.uniswap.org/contracts/v4/overview
- Uniswap v4 AsyncSwap/custom accounting context: https://docs.uniswap.org/contracts/v4/quickstart/hooks/async-swap
- OpenZeppelin Uniswap Hooks base contracts: not used in this frontend page.
*/

import MyIntents from "../components/MyIntents.vue";
import QueueSwapForm from "../components/QueueSwapForm.vue";
import WalletPanel from "../components/WalletPanel.vue";
import WindowStatus from "../components/WindowStatus.vue";
import AppShell from "../layouts/AppShell.astro";
---

<AppShell
  title="StealthSwap - Uniswap v4 Privacy DeFi"
  subtitle="Deterministic batching for swaps: reduce timing leakage, settle pro-rata, and claim verifiable outputs."
  pageId="swap"
>
  <section class="workflow-layout" id="queue-workflow">
    <section class="workflow-main">
      <article class="glass-card" id="step-1">
        <div class="section-row">
          <h2 class="section-title"><span class="step-index">1</span>Queue Into Batch</h2>
          <span class="chip chip-queued">Signature Required</span>
        </div>
        <p class="section-note">
          Connect wallet, set your limits, and queue your order into the active batch window.
        </p>
        <WalletPanel client:load />
        <QueueSwapForm client:load />
      </article>

      <article class="glass-card" id="step-2">
        <div class="section-row">
          <h2 class="section-title"><span class="step-index">2</span>Batch Window</h2>
          <span class="chip chip-clearable">Deterministic Rules</span>
        </div>
        <p class="section-note">
          Track current window timing and deterministic transition: Collecting to Clearable to Settled.
        </p>
        <WindowStatus client:load />
      </article>

      <article class="glass-card" id="step-3">
        <div class="section-row">
          <h2 class="section-title"><span class="step-index">3</span>After Clear</h2>
          <span class="chip chip-cleared">Pro-Rata Settlement</span>
        </div>
        <ul class="rule-list">
          <li>Claim Output after window clear.</li>
          <li>Pro-rata distribution normalizes execution impact across intents.</li>
          <li>
            Sweep Dust means unallocated remainder after floor rounding, handled transparently in the
            contract.
          </li>
        </ul>
      </article>

      <article class="glass-card" id="step-4">
        <div class="section-row">
          <h2 class="section-title"><span class="step-index">4</span>Activity</h2>
          <span class="chip chip-success">Your Intents + Recent Clears</span>
        </div>
        <p class="section-note">
          Review queued/clearable/claimed states, inspect claimable estimates, and claim output.
        </p>
        <MyIntents client:load />
      </article>
    </section>

    <aside class="secondary-panel">
      <article class="glass-card">
        <h3 class="section-title">How StealthSwap Protects You</h3>
        <ul class="bullet-list">
          <li>Batching reduces per-user swap signature and timing leakage.</li>
          <li>Pro-rata settlement normalizes execution impact inside each window.</li>
          <li>Deterministic onchain rules are verifiable end-to-end.</li>
        </ul>
      </article>

      <article class="glass-card">
        <h3 class="section-title">Execution Model</h3>
        <p class="section-note">
          Hook-attached pool behavior governs queue, clear, and claim lifecycle with no hidden
          offchain matching logic.
        </p>
        <div class="button-row">
          <a class="micro-link" href="https://docs.uniswap.org/contracts/v4/concepts/hooks" target="_blank" rel="noreferrer">
            Hooks
          </a>
          <a class="micro-link" href="https://docs.uniswap.org/contracts/v4/quickstart/hooks/async-swap" target="_blank" rel="noreferrer">
            AsyncSwap
          </a>
          <a class="micro-link" href="https://docs.uniswap.org/contracts/v4/overview" target="_blank" rel="noreferrer">
            PoolManager Lifecycle
          </a>
        </div>
      </article>
    </aside>
  </section>
</AppShell>
